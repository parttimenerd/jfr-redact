# yaml-language-server: $schema=../../../config-schema.json
# hs_err preset - optimized for redacting Java crash reports (hs_err_pid*.log)
# Version: 1.0.0
#
# This preset is specifically designed for JDK developers who need to share
# hs_err files in bug reports while protecting sensitive information.
#
# hs_err files contain:
# - Hostname and OS information
# - User home directories and paths
# - Environment variables (potentially containing secrets)
# - Command line arguments (may contain passwords/tokens)
# - Process and system information
#
# Usage:
#   jfr-redact redact-text hs_err_pid12345.log --preset hserr
#
parent: default

# Property redaction - extended for hs_err content
properties:
  enabled: true
  patterns:
    # Additional patterns commonly found in hs_err
    - user(name)?          # user, username
    - login
    - host(name)?          # host, hostname
    - machine
    - owner

# String patterns - aggressive settings for hs_err
strings:
  enabled: true
  redact_in_method_names: false
  redact_in_class_names: false
  redact_in_thread_names: true  # Thread names may contain user info

  patterns:
    # Home directories
    home_directories:
      enabled: true

    # Email addresses (common in configuration)
    emails:
      enabled: true

    # UUIDs (enabled for hs_err - may identify machines)
    uuids:
      enabled: true

    # IP addresses - customize IPv4 to avoid matching version numbers like clang-1403.0.22.14.1
    ip_addresses:
      enabled: true
      # IPv4 - require first octet to be 1-255 (not 0) to avoid matching version numbers
      ipv4: '\b(?:[1-9][0-9]{0,2}\.(?:[0-9]{1,3}\.){2}[0-9]{1,3})\b'
      # Only match full IPv6 addresses, not compressed forms like ead:: or ::1
      # which conflict with C++ method names in stack traces
      ipv6: '\b(?:[0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}\b'
      # Ignore compiler version numbers that look like IPs
      ignore_after:
        - 'clang-[0-9]*'      # clang version numbers like clang-1403.0.22.14.1
        - 'gcc-[0-9]*'        # gcc version numbers
        - 'g++-[0-9]*'        # g++ version numbers
        - 'LLVM [0-9]*'       # LLVM version strings

    # SSH hosts - customized for hs_err to avoid matching method references like init@0
    ssh_hosts:
      enabled: true
      patterns:
        - 'ssh://[a-zA-Z0-9.-]+'                                          # ssh://hostname
        - '(?:ssh|sftp)://(?:[^@]+@)?[a-zA-Z0-9.-]+'                      # ssh://user@hostname
        # Require host part to start with a letter (not digits like init@0 or user@192.168.1.1)
        - '[a-zA-Z0-9_-]+@[a-zA-Z][a-zA-Z0-9.-]*(?::[0-9]+)?'             # user@host (host must start with letter)
        - '(?<=ssh\s)[a-zA-Z0-9_-]+@[a-zA-Z][a-zA-Z0-9.-]+'               # after "ssh " command

    # Hostnames - DISABLED by default for hs_err to avoid false positives
    # Users should specify specific hostnames via command line or config
    hostnames:
      enabled: false
      patterns:
        # hs_err "Host:" line pattern - handled separately via custom pattern below
        - '(?<=Host:\s)[a-zA-Z][a-zA-Z0-9._-]*'
      ignore_exact:
        - localhost
        - localhost.localdomain
        - '127.0.0.1'

    # Internal URLs - DISABLED to avoid false positives on public URLs like bugreport.java.com
    # Add specific internal URL patterns via custom patterns if needed
    internal_urls:
      enabled: false

    # Custom patterns specific to hs_err files
    custom:
      # hs_err "Host:" line - redact only the hostname at the beginning
      - name: hs_err_host_line
        regex: '(?<=Host:\s)[A-Za-z][A-Za-z0-9_-]*(?=,|\s)'
      # JDK version strings - redact username in adhoc builds like "22-internal-adhoc.username.jdk"
      - name: jdk_adhoc_username
        regex: '(?<=adhoc\.)[a-zA-Z][a-zA-Z0-9_-]*(?=\.)'
      # JVM command-line arguments with sensitive values
      - name: jvm_sensitive_args
        regex: '-D(?:password|secret|token|auth|credential)[^=]*=[^\s]+'
      # Oracle/database connection strings
      - name: db_connection
        regex: 'jdbc:[a-zA-Z0-9]+://[^\s"'']+'
      # AWS/cloud credentials in arguments
      - name: aws_credentials
        regex: '(?:AWS_|AMAZON_)[A-Z_]*(?:KEY|SECRET|TOKEN)[^\s=]*=[^\s]+'
      # JAVA_HOME and similar paths that might reveal structure
      - name: java_paths
        regex: '(?:JAVA_HOME|JRE_HOME|JDK_HOME)=[^\s]+'
      # OS uptime - reveals how long the machine has been running
      - name: os_uptime
        regex: '(?<=OS uptime:\s)[^\n]+'
      # User/group IDs that may be sensitive
      - name: user_ids
        regex: '(?<=uid\s*:\s)\d+|(?<=euid\s*:\s)\d+|(?<=gid\s*:\s)\d+|(?<=egid\s*:\s)\d+'
      # uname hostname - redact hostname after "Darwin " or "Linux " in uname line
      - name: uname_hostname
        regex: '(?<=uname:\s(?:Darwin|Linux)\s)[A-Za-z][A-Za-z0-9_-]*(?=\s)'
      # Builder username in vm_info line - redact username in 'built ... by "username"'
      - name: vm_info_builder
        regex: '(?<=by\s")[a-zA-Z][a-zA-Z0-9_-]*(?=")'

# Path redaction - aggressive for hs_err
paths:
  enabled: true
  mode: keep_filename  # Keep filename but redact directory structure

# General settings
general:
  redaction_text: "***"
  partial_redaction: false
  pseudonymization:
    enabled: false  # Enable with --pseudonymize if needed