# yaml-language-server: $schema=../../../config-schema.json
# hs_err preset - optimized for redacting Java crash reports (hs_err_pid*.log)
# Version: 1.0.0
#
# This preset is specifically designed for JDK developers who need to share
# hs_err files in bug reports while protecting sensitive information.
#
# hs_err files contain:
# - Hostname and OS information
# - User home directories and paths
# - Environment variables (potentially containing secrets)
# - Command line arguments (may contain passwords/tokens)
# - Process and system information
#
# Usage:
#   jfr-redact redact-text hs_err_pid12345.log --preset hserr
#
parent: default

# Property redaction - extended for hs_err content
properties:
  enabled: true
  patterns:
    # Additional patterns commonly found in hs_err
    - user(name)?          # user, username
    - login
    - host(name)?          # host, hostname
    - machine
    - owner

# String patterns - aggressive settings for hs_err
strings:
  enabled: true
  redact_in_method_names: false
  redact_in_class_names: false
  redact_in_thread_names: true  # Thread names may contain user info

  patterns:
    # Home directories
    home_directories:
      enabled: true

    # Email addresses (common in configuration)
    emails:
      enabled: true

    # UUIDs (enabled for hs_err - may identify machines)
    uuids:
      enabled: true

    # IP addresses
    ip_addresses:
      enabled: true

    # SSH hosts (often in stack traces/configs)
    ssh_hosts:
      enabled: true

    # Hostnames - ENABLED for hs_err
    hostnames:
      enabled: true
      patterns:
        # hs_err "Host:" line pattern
        - '(?<=Host:\s)[a-zA-Z0-9][a-zA-Z0-9._-]*'
        # FQDN with multiple domain parts
        - '\b[a-zA-Z0-9][a-zA-Z0-9-]*(?:\.[a-zA-Z0-9][a-zA-Z0-9-]*){2,}\b'
        # uname -a hostname
        - '(?<=Linux\s|Darwin\s)[a-zA-Z0-9][a-zA-Z0-9._-]*(?=\s)'
        # Hostname after "PRETTY_NAME" or similar OS info
        - '(?<=kernel:\s)[a-zA-Z0-9][a-zA-Z0-9._-]*'
      safe_hostnames:
        - localhost
        - localhost.localdomain
        - '127.0.0.1'

    # Internal URLs - ENABLED for hs_err
    internal_urls:
      enabled: true
      patterns:
        # Artifactory/Nexus/repo URLs
        - 'https?://[a-zA-Z0-9.-]*(?:artifactory|nexus|repo|repository)[a-zA-Z0-9.-]*/[^\s"'']*'
        # Internal Git URLs
        - 'https?://[a-zA-Z0-9.-]*(?:git|gitlab|github|bitbucket)[a-zA-Z0-9.-]*/[^\s"'']*'
        # Generic internal URLs
        - 'https?://[a-zA-Z0-9.-]*(?:intranet|internal|corp|private)[a-zA-Z0-9.-]*/[^\s"'']*'
        # CI/build URLs
        - 'https?://[a-zA-Z0-9.-]*(?:jenkins|ci|build|bamboo)[a-zA-Z0-9.-]*/[^\s"'']*'
      internal_domains:
        - '.internal'
        - '.corp'
        - '.local'
        - '.intranet'

    # Custom patterns specific to hs_err files
    custom:
      # JVM command-line arguments with sensitive values
      - name: jvm_sensitive_args
        regex: '-D(?:password|secret|token|key|auth|credential)[^=]*=[^\s]+'
      # Oracle/database connection strings
      - name: db_connection
        regex: 'jdbc:[a-zA-Z0-9]+://[^\s"'']+'
      # AWS/cloud credentials in arguments
      - name: aws_credentials
        regex: '(?:AWS_|AMAZON_)[A-Z_]*(?:KEY|SECRET|TOKEN)[^\s=]*=[^\s]+'
      # JAVA_HOME and similar paths that might reveal structure
      - name: java_paths
        regex: '(?:JAVA_HOME|JRE_HOME|JDK_HOME)=[^\s]+'

# Path redaction - aggressive for hs_err
paths:
  enabled: true
  mode: keep_filename  # Keep filename but redact directory structure

# General settings
general:
  redaction_text: "***"
  partial_redaction: false
  pseudonymization:
    enabled: false  # Enable with --pseudonymize if needed